---
title: "Tornadoes threathen health, floods destroy property."
author: "Sander Schrieken"
date: "10/30/2017"
output: html_document
---

## Summary

This report analyses the effects of severe weather events in the US. The NOAA Storm Database was used to determine which weather events cause injury, death, property and crop damage. The database covers the period 1950 - 2011. It provides information on more than 900,000 weather events. After we removed improper entries from the dataset we were left with about 270,000 events. These events were grouped by event type, after which the total number of injuries / fatalities per type were calculated. The total damage to property / crops was produced too. As was the number of events in each group. The analysis shows that tornadoes have the biggest impact on public health, since they are responsible for the highest number of injuries and fatalities. Floods cause most of the damage to property and crops.


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
The basic goal of this assignment is to explore the NOAA Storm Database and answer some basic questions about severe weather events.

## Questions

1. Does the analysis address the question of which types of events are most harmful to population health?
2. Does the analysis address the question of which types of events have the greatest economic consequences?


## Importing Data

Does the analysis start from the raw data file (i.e. the original .csv.bz2 file)?

The code below downloads the data from the Coursera webpage for the Reproducible Research Course Project (#2). This is the [link](https://www.coursera.org/learn/reproducible-research/peer/OMZ37/course-project-2) to that page.

```{r download_(meta)_data, message=FALSE, warning=FALSE, eval=FALSE, cache=TRUE}
Download_Date <- Sys.Date() # First, fix the date we download the data!

source_url <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"
download.file(source_url, destfile = "StormData.csv.bz2", 
              method = "curl")

source_url_2 <- "https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2Fpd01016005curr.pdf"
download.file(source_url_2, destfile = "repdata-peer2_doc-pd01016005curr.pdf", 
              method = "curl")

source_url_3 <- "https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2FNCDC%20Storm%20Events-FAQ%20Page.pdf"
download.file(source_url_3,
              destfile = "repdata-peer2_doc-NCDC Storm Events-FAQ Page.pdf",
              method = "curl")
```

```{r rename_meta_data_files, echo=TRUE, results="hide", message=FALSE, warning=FALSE, cache=TRUE}
# The names of the files are unwieldy; we should consider renaming them...
file.rename("repdata-peer2_doc-pd01016005curr.pdf", "Storm Data Documentation.pdf")
file.rename("repdata-peer2_doc-NCDC Storm Events-FAQ Page.pdf", "Storm Events FAQs.pdf")
```


## Data Processing

Is there a section titled "Data Processing" that describes how the data were loaded into R and processed for analysis?

Reading the downloaded data into R can be done with `read.csv()`. By using this function we don't have to unzip the compressed file separately, since `read.csv()` can handle this for us. The following code reads the downloaded data into R. We will _NOT_ run it, however, because this is slow.

```{r importing_StormData_read.csv, cache=TRUE, eval=FALSE}
StormData <- read.csv("StormData.csv.bz2", stringsAsFactors = FALSE)
```

The `data.table` package provides a much faster way of getting the data into R, so we
will use that instead:

```{r install_data.table, message=FALSE, warning=FALSE}
options(repos="https://cran.rstudio.com" )
if (!require(data.table)) install.packages("data.table")
library(data.table)
```

Note that `fread()` can not handle the unzipping for us. We will have to use the bunzip2 shell command for that. Luckily `fread()` can handle shell commands and process the output:

```{r importing_StormData_fread, message=FALSE, warning=FALSE, cache=TRUE}
StormData <- fread('bunzip2 -ck StormData.csv.bz2')
```

We've set `cache` to TRUE for the code chunk above to avoid endless importing during debugging, or when running / knitting the document multiple times. Loading the data into R must be cached. Eventhough `fread()` is a lot faster than `read.csv()` (a couple of seconds versus minutes!), it's still a good idea to prevent the code from running repeatedly.




## Results

Is there a section titled "Results" where the main results are presented?

Preliminary thoughts on the matter:

Which types of events are most harmful to population health???

There seem to be two variables that affect population health: FATALITIES and INJURIES. Possibly events with many fatalities will also show a lot of injuries, but we don't know. Something to find oud. There could be a difference in the top 10 events causing fatalities and injuries. Is an event with many injuries more harmful to population health than an event without injuries where one person died? That's a difficult question to answer, so it's probably best analyse fatalities and injuries together. It would be nice if there was a strong correlation. When there are obvious differences, we should point them out.

Drawing a plot wit injuries (x) and fatalities (y) shows a picture that apparently lacks significant correlation. The other way around (fatalies on X, and injuries on Y) doesn't change that. So there's hardly any meaningful correlation between number of injuries and number of fatalities. The 1995 heatwave resulted in almost 600 deaths, but very few injuries by comparison. On the other hand the 1979 Tornado (Whichita, TX) caused 1700 injuries and 'only' 42 fatalities.

Looking at the totals TORNADO events top the list in both fatalities and injuries. When looking at average number of injuries / fatalities per type of event TORNADO's score higher aswel (more fatalities). Heat-related events cause a higer number of injuries on average, but they occur way less often. Because TORNADO's are very common they have the most impact on the health of the population. See [DO].R and EDA.R for analyses and calculations.



## Review Criteria

1. Has either a (1) valid RPubs URL pointing to a data analysis document for this assignment been submitted; or (2) a complete PDF file presenting the data analysis been uploaded?
2. Is the document written in English?
3. Does the analysis include description and justification for any data transformations?
4. Does the document have a title that briefly summarizes the data analysis?
5. Does the document have a synopsis that describes and summarizes the data analysis in less than 10 sentences?
6. Is there a section titled "Data Processing" that describes how the data were loaded into R and processed for analysis?
7. Is there a section titled "Results" where the main results are presented?
8. Is there at least one figure in the document that contains a plot?
9. Are there at most 3 figures in this document?
10. Does the analysis start from the raw data file (i.e. the original .csv.bz2 file)?
11. Does the analysis address the question of which types of events are most harmful to population health?
12. Does the analysis address the question of which types of events have the greatest economic consequences?
13. Do all the results of the analysis (i.e. figures, tables, numerical summaries) appear to be reproducible?
14. Do the figure(s) have descriptive captions (i.e. there is a description near the figure of what is happening in the figure)?
15. As far as you can determine, does it appear that the work submitted for this project is the work of the student who submitted it?
